"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseTransform = exports.parse = void 0;
const types_1 = require("./types");
function parse(str) {
    // We don't use the reviver option in `JSON.parse(str, reviver)` because it doesn't support `undefined` values
    const value = JSON.parse(str);
    return parseTransform(value);
}
exports.parse = parse;
function parseTransform(value) {
    if (typeof value === 'string') {
        return reviver(value);
    }
    if (
    // Also matches arrays
    typeof value === 'object' &&
        value !== null) {
        Object.entries(value).forEach(([key, val]) => {
            ;
            value[key] = parseTransform(val);
        });
    }
    return value;
}
exports.parseTransform = parseTransform;
function reviver(value) {
    for (const { match, deserialize } of types_1.types) {
        if (match(value)) {
            return deserialize(value, parse);
        }
    }
    return value;
}
